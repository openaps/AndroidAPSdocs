# Freestyle Libre 2

Сенсор Freestyle Libre 2 теперь является полноценным непрерывным мониторингом даже с официальным приложением. Тем не менее, LibreLink не в состоянии отправлять данные в AAPS. Для взаимодействия Libre 2 с AAPS существует несколько решений.

## 1. Использовать мост Bluetooth и алгоритм OOP

Трансмиттеры Bluetooth Libre 2 (EU) можно использовать с приложением [алгоритма выхода из процесса](https://drive.google.com/file/d/1f1VHW2I8w7Xe3kSQqdaY3kihPLs47ILS/view) OOP. В этом случае Вы будете получать показания сахара крови каждые 5 минут, так же как и с Libre1.

Убедитесь, что мост и приложение, которое вы хотите использовать, совместимы с вашим сенсором и xDrip+ (более старые модели Blucon не будут работать, Miaomiao 1 требует прошивки 39 и Miaomiao 2 прошивки 7).

Алгоритм ООП Libre2 выдает те же показания BГк, что и при использовании оригинального ридера или приложения LibreLink при сканировании NFC. Во избежание скачков, AAPS с Libre2 производит сглаживание в пределах от 10 до 25 минут. См. ниже [Сглаживание показаний & необоаботанные данные](#value-smoothing-raw-values). Алгоритм программы генерирует данные каждые 5 минут со сглаживанием по среднему значению за последние 5 минут. Поэтому значения ГК не выглядят гладкими, а совпадают с показаниями оригинального устройства считывания и быстрее следуют "реальным". Если вы хотите пользоваться алгоритмом OOP, включите все настройки сглаживания в xDrip+.

Есть несколько веских причин пользоваться передатчиком Bluetooth:

-   Вы можете выбрать различные стратегии калибровки OOP2 (1): получать значения с ридера, "без калибровки", калибровать сенсор, как Libre 1 "на основе необработанных данных", или, в конечном счете, калибровать значения "на основе глюкозы".  
  Убедитесь, что OOP1 отключен (2).

    → Сэндвич-меню → Настройки →Менее распространенные настройки → Другие разные настройки. Варианты

![Калибровка OOP2](../images/Libre2_OOP2Calibration.png)

-   Libre2 может работать 14,5 дней как и Libre1
-   Полностью поддерживается восьмичасовое обратное заполнение данными

Замечание: Трансмиттер можно использовать параллельно с приложением LibreLink.

## 2. Использовать прямое подключение xDrip+

```{admonition} Libre 2 EU only
:class: warning
xDrip+ doesn't support direct connection to Libre 2 US and AUS.  
```

- Следуйте [этим инструкциям](https://www.minimallooper.com/post/how-to-setup-freestyle-libre-2-and-oop2-to-use-a-native-bluetooth-connection-in-xdrip) для настройки xDrip+, но обязательно загрузите [эту новую версию OOP 2](https://drive.google.com/file/d/1f1VHW2I8w7Xe3kSQqdaY3kihPLs47ILS/view), поскольку та, что приведена в документе, устарела.
- Следуйте инструкциям по установке на странице настроек [xDrip+](../Configuration/xdrip.md).

-   Select xDrip+ in in [ConfigBuilder, BG Source](../Configuration/Config-Builder.md#bg-source).

## 3. Использовать Diabox

- Install [Diabox](https://www.bubblesmartreader.com/_files/ugd/6afd37_f183eabd4fbd44fcac4b1926a79b094f.pdf). В Настройках, Интеграция, включите "Делиться данными с другими приложениями".

![Diabox](../images/Diabox.png)

- Select xDrip+ in in [ConfigBuilder, BG Source](../Configuration/Config-Builder.md#bg-source).

## 4. Использовать Juggluco

- Скачайте и установите приложение Juggluco [отсюда](https://www.juggluco.nl/Juggluco/download.html).
- Следуйте инструкциям [здесь](https://www.juggluco.nl/Juggluco/index.html)
- В Настройках включите трансляцию в xDrip+ (посылает данные не в xDrip+, а в AAPS).

![Juggluco broadcast to AAPS](../images/Juggluco_AAPS.png)

- Select xDrip+ in in [ConfigBuilder, BG Source](../Configuration/Config-Builder.md#bg-source).

```{admonition} Use with xDrip+
:class: note
You can set Juggluco to broadcast to xDrip+ with Patched Libre Broadcast (you should disable xDrip+ broadcast), in order to calibrate (see here) and avoid 1 minute readings to be sent to AAPS.  
![Juggluco broadcast to xDrip+](../images/Juggluco_xDrip.png)  
You will then need to set xDrip+ data source to Libre 2 Patched App to receive data from Juggluco.  
```

## 5. Использовать модифицированное приложение LibreLink с xDrip+

```{admonition} Libre 2 EU only
:class: warning
The patched app is an old version (22/4/2019) and might not be compatible with recent Android releases.  
```

### Шаг 1: Создаем модифицированное приложение

По юридическим причинам установка так называемого патча выполняется самостоятельно. Используйте поисковые системы для поиска соответствующих ссылок. Существует два варианта: рекомендуемое оригинальное модифицированное приложение блокирует любой интернет-трафик, чтобы избежать отслеживания. Другой вариант поддерживает LibreView.

Вместо оригинального приложения следует установить модифицированное. Следующий датчик, установленный с его помощью, будет передавать текущие значения гликемии приложению xDrip+, работающему на смартфоне через Bluetooth.

Важно: чтобы избежать возможных проблем, рекомендуем сначала установить и затем деинсталлировать оригинальное приложение на смартфон с поддержкой NFC. NFC должен быть включен. Он не требует дополнительной энергии. Затем установите модифицированное приложение.

Исправленное приложение можно определить с помощью уведомления об авторизации в главном режиме. Служба агрессивной авторизации повышает стабильность соединения по сравнению с исходным приложением, которое не использует эту службу.

![LibreLink (основной режим)](../images/Libre2_ForegroundServiceNotification.png)

Другими признаками могут быть логотип пингвина Linux в меню с тремя точками -> Шрифт информации и приложения (2), отличается от оригинального приложения (1). Эти критерии необязательны и зависят от выбранного источника скачивания приложения.

![Проверка шрифтов LibreLink](../images/LibreLinkPatchedCheck.png)

Убедитесь, что NFC активирована дайте разрешения на обращение к памяти и геолокации, включите автоматическое время и часовой пояс и задайте хотя бы одно оповещение в этом приложении.

### Шаг 2: Запускаем сенсор при помощи модифицированного приложения

Теперь запустите сенсор Libre2 при помощи модифицированного приложения, просто сканируя сенсор. Убедитесь, что заданы все параметры.

Обязательные параметры для успешного запуска сенсора:

-   NFC включен/BT включен
-   включено разрешение на память и геолокацию
-   Включена служба определения местоположения
-   автоматическое определение времени и часового пояса
-   задать хотя бы одно оповещение в модифицированном приложении

Обратите внимание, что служба определения расположения является центральным параметром. Это не разрешение на доступ к геолокации в приложении, которое также должно быть активировано!

![LibrreLink-разрешение на доступ к памяти & расположению](../images/Libre2_AppPermissionsAndLocation.png)

![автоматическое определение времени и часового пояса + настройки оповещений](../images/Libre2_DateTimeAlarms.png)

После того, как сенсор запустится при помощи модифицированного приложения, его нельзя будет подключить к другому приложению / телефону. Если удалить приложение, будут утрачены оповещения и непрерывный поток данных ГК.

Первая установка соединения с сенсором имеет решающее значение. Приложение LibreLink пытается установить беспроводное соединение с сенсором каждые 30 секунд. Если один или несколько обязательных параметров отсутствуют, их надо скорректировать. У вас нет ограничений по времени для этого. Сенсор постоянно пытается установить соединение. Даже если это длится несколько часов. Будьте терпеливы и пробуйте другие настройки, прежде чем даже подумать о замене сенсора.

Если вы видите красный восклицательный знак ("!") в левом верхнем углу начального экрана Libre Link, это значит, что отсутствует подключение или какая-либо другая настройка блокирует подачу сигналов Libre Link. Проверьте, включен ли звук и отключены ли все виды блокировок уведомлений от приложений. Когда восклицательный знак исчезнет, соединение будет установлено и значения гликемии отправятся на смартфон. Это должно произойти не более чем через 5 минут.

![LibreLink нет соединения](../images/Libre2_ExclamationMark.png)

Если восклицательный знак остается или сприходят ообщения об ошибке, это может иметь несколько причин:

-   Служба определения местоположения Android не получила разрешений - включите ее в системных настройках
-   автоматическое время и часовой пояс не заданы - измените настройки
-   активируйте оповещения - по крайней мере один из трех сигналов в LibreLink
-   Bluetooth выключен - включите
-   звук заблокирован
-   уведомления приложений заблокированы
-   неактивные уведомления на экране заблокированы

Перезапуск телефона помогает, возможно, придется перезапустить несколько раз. Как только соединение будет установлено, красный восклицательный знак исчезнет и самый важный этап - сопряжение - пройден. Может случиться так, что в зависимости от системных настроек восклицательный знак остается, но данные идут. В обоих случаях нет причин беспокоиться. Сенсор и телефон теперь сопряжены, каждую минуту передаются данные ГК.

![Соединение LibreLink установлено](../images/Libre2_Connected.png)

Иногда может помочь очистка кэша bluetooth и/или сброс всех сетевых соединений через меню системы. Это удалит все подключенные устройства bluetooth и, возможно восстановит правильное соединение. Эта процедура безопасна, поскольку запущенный сенсор уже запомнен модифицированным приложением LibreLink. Ничего дополнительного здесь не требуется. Просто подождите подключения модифицированного приложения к сенсору.

После успешного подключения при необходимости можно изменить настройки смартфона. Это не рекомендуется, но вы можете захотеть экономить энергию. Служба определения местоположения может быть отключена, громкость установлена на ноль, сигналы снова отключены. Данные сахара крови в любом случае передаются.

Однако, при запуске следующего сенсора, все параметры должны быть установлены снова!

Замечание: чтобы включить соединение, приложению требуются обязательные настройки, установленные в течение часа после разогрева,. Они не нужны в течение 14-дневного периода работы. В большинстве случаев при проблемах с запуском сенсора была выключена служба определения местоположения. На Android это необходимо для правильной работы Bluetooth. См. документацию Google Android.

В течение 14 дней для сканирования при работе с приложением LibreLink можно использовать параллельно один или несколько смартфонов с NFC (не ридер!). Для того чтобы начать сканирование нет ограничений по времени. Можно начать сканирование еще одним телефоном, например, на пятый или любой другой день. Второй телефон (телефоны) может передавать значения сахара крови в Abbott Cloud (LibreView). LibreView может генерировать отчеты для специалистов.

Обратите внимание, что модифицированное приложение не имеет подключения к Интернету, чтобы избежать отслеживания.

Однако существует вариант модифицированного приложения с включенным доступом в Интернет для поддержки LibreView. В этом случае имейте в виду, что данные передаются в облако. Но в этом случае отчеты для вашего эндокринолока полностью поддк=ерживаются. С помощью такого варианта можно также перенести оповещения сенсора на другое устройство, которое не запускало сенсор. Подробно о том, как это сделать, можно найти поиском google на немецких диабетических форумах.

### Шаг 3: Устанавливаем и настраиваем приложение xDrip+

Значения гликемии передаются на смартфон приложением xDrip+.

-   Вы можете безопасно загрузить [ новую (стабильную) версию APK ](https://xdrip-plus-updates.appspot.com/stable/xdrip-plus-latest.apk), если только вам не нужны новейшие функции. В этом случае следует загружать т. н. [Ночную сборку](https://github.com/NightscoutFoundation/xDrip/releases).
-   Настройте xDrip+ с [модифицированным приложением LibreLink в качестве источника данных ГК](../Configuration/xdrip.md#lbre-2-patched-app).
-   Следуйте инструкциям по установке на странице настроек [xDrip+](../Configuration/xdrip.md).

### Шаг 4: Запускаем сенсор

- → Сэндвич-меню (1) → Запустить сенсор (2) → Запустить сенсор (3) → Ответ "Не сегодня" (4).

![xDrip+ запуск трансмиттера Libre & Сенсора 3](../images/xDrip_Libre_Transmitter03.png)

На самом деле эта команда физически не запустит сенсор Libre2 и не начнет взаимодействие с ним. Это нужно для того, чтобы указать xDrip+, что новый сенсор начал передавать ГК. Если доступно, введите два замера крови для начальной калибровки. Теперь значения глюкозы крови должны отображаться в xDrip+ каждые 5 минут. Пропущенные данные, например из-за того, что вы были далеко от телефона, не будут восстановлены.

После смены сенсора xDrip+ автоматически определит новый и удалит все данные калибровки. После активации можно измерить ГК и выполнить новую начальную калибровку.

### Шаг 5: Настраиваем AAPS (для работы в замкнутом/незамкнутом цикле)

-   В AAPS перейдите в Конфигуратор > Источник ГК и выберите 'xDrip+'

![Источник ГК в xDrip+](../images/ConfBuild_BG_xDrip.png)

-   Если AAPS не получает значения ГК, когда телефон находится в режиме авиаперелета пользуйтесь функцией "Установить получателя" в соответствии с описанием [настроек xDrip+](xdrip-identify-receiver).

До настоящего времени, при выборе Libre 2 в качестве источника данных ГК, в алгоритме SMB невозможно активировать «Включить SMB всегда» и «Включить SMB после углеводов». Значения BG Libre 2 недостаточно сглажены, чтобы их безопасно использовать. Подробнее см. [Сглаживание данных Гк](../Usage/Smoothing-Blood-Glucose-Data-in-xDrip.md).

(Libre2-experiences-and-troubleshooting)=
### Опыт и устранение неполадок

#### Связь

У большинства телефонов связь хорошая, за исключением мобильных телефонов Huawei. Связь может прерваться, когда мобильный телефон находится в кармане напротив сенсора или когда вы на улице. Носите телефон на теле со стороны сенсора. В помещениях, где устройства Bluettooth работают за счет отражений, нет никаких проблем. Если возникают проблемы с подключением, попробуйте другой телефон. Также может помочь установка сенсора антенной BT вниз. При установке сенсора прорезь на аппликаторе должна быть направлена вниз.

#### Сглаживание данных & необработанные данные

Технически, текущее значение сахара в крови передается на xDrip + каждую минуту. По умолчанию фильтр средневзвешенного значения вычисляет сглаженное значение за последние 25 минут. Этот период можно изменить в меню функций сканирования NFC.

→ Сэндвич-меню → Настройки →Функция сканирования NFC→ Сглаживать данные libre 3 при использовании метода xxx

![xDrip + дополнительные параметры Libre 2 & необработанные данные](../images/xDrip_Libre3_Smooth.png)

Это обязательно для цикла. Кривые выглядят гладкими, и результаты работы цикла великолепны. Необработаные значения, на которых основаны оповещения, имеют несколько больший разборос, но в конечном счете соответствуют показателям ридера. Кроме того, необработанные значения могут отображаться на графике xDrip+, чтобы имелась возможность своевременно реагировать на быстрые изменения. Переключитесь на Менее распространенные Настройки\ > Расширенные настройки для Libre2 \>"показывать необработанные значения" и "показывать Информацию с сенсора". После этого "необработанные" значения будут дополнительно отображается в виде небольших белых точек, а в меню системы будет доступна дополнительная информация о сенсоре.

Необработанные данные очень полезны при быстрых изменениях ГК. Даже если точки идут вразброс, для принятия решений по терапии тенденция видна гораздо лучше, чем при сглаживании.

→ Сэндвич-меню → Настройки →Менее распространенные настройки → Advanced settings for Libre 2 (дополнительные настройки для Libre 2)

![xDrip + дополнительные параметры Libre 2 & необработанные данные](../images/Libre2_RawValues.png)

#### Время работы сенсора

Рабочее время сенсора фиксируется на 14 дней. 12 дополнительных часов Либре1 больше не существует. xDrip + показывает дополнительную информацию о сенсорах после включения дополнительных настроек для Libre2 → "показывать информацию о датчиках" в системном меню, например, время запуска. Оставшееся время сенсора можно также увидеть в модифицированном приложении LibreLink. Либо на главном экране как отображение оставшихся дней, либо как время запуска сенсора в трехточечном меню → Справка → Журнал событий в разделе "Новый сенсор найден".

![Libre 2 время запуска](../images/Libre2_Starttime.png)

#### Новый сенсор

Замена сенсора происходит на лету: установите новый сенсор незадолго до активации. Как только xDrip+ больше не получает данных от старого сенсора, запустите новый при помощи модифицированного приложения. Через час новые значения должны появиться автоматически в xDrip+.

В противном случае проверьте настройки телефона и перейдите к первоначальному запуску. У вас нет ограничения по времени. Постарайтесь найти правильные настройки. Нет необходимости сразу же менять сенсор пока не перепробованы разные комбинации. Сенсоры прочны, постарайтесь установить надежное соединение. Не торопитесь. В большинстве случаев вы могли случайно изменить какой-то один параметр, который вызывает проблемы.

При успехе выберите "стоп сенсор" и "только удалить калибровки" в xDrip. Xdrip + сможет понять, что новый сенсор получает данные сахара в крови, а старые калибровки больше не действительны и должны быть удалены. Никакого реального взаимодействия с сенсором Libre2 при этом не происходит! Запускать сенсор в xDrip не требуется+.

![xDrip + пропущенные данные при замене сенсора Libre 2](../images/Libre2_GapNewSensor.png)

#### Калибровка

Libre2 можно калибровать **с погрешностью -40 мг/дл до +20 мг/dL [-2,2 ммоль/л до +1,1 ммоль/л] **(intercept). Угловой коэффициент не изменяется. Проверьте глюкометром после установки нового сенсора, имея в виду, что в первые 12 часов после установки данные могут быть неточны. Поскольку показатели ГК могут сильно отличаться, проверяйте каждые 24 часа и при необходимости калибруйте. Если через несколько дней показания сенсора совершенно не совпадают с глюкометром, сенсор следует заменить.

### Верификация

Сенсоры Libre2 способны выполнять самопроверку для обнаружения плохих сенсоров. Как только сенсор смещается на руке или слегка приподнимается, данные могут начать колебаться. После этого датчик Libre2 отключится по соображениям безопасности. К сожалению, при сканировании при помощи приложения, проводятся дополнительные проверки. Приложение может отключить сенсор, даже если он исправен. В настоящее время внутренний тест слишком жесткий. Избегайте сканирования сенсора другим телефоном, чтобы уменьшить риск его неожиданного отключения.

# Наилучшие методы калибровки Libre 2

Существует несколько "правил" для лучших результатов калибровки сенсоров Libre 2. Они не зависят от программного обеспечения (например, модифицированное приложение libre2, oop2, …), для обработки значений Libre2 .

1.  Самое важное правило - калибровать датчик только тогда, когда значения идут ровно не менее 15 минут. Разница между последними тремя величинами не должна превышать 10мг/дл (за 15 минут, а не между каждым замером). Поскольку Libre 2 замеряет не уровень гликемии крови, а уровень в подкожных тканях, существует некоторая задержка показаний, особенно при подъеме или падении. Эта задержка может иногда приводить к слишком большим сдвигам в калибровках даже если уровень ГК поднимается/падает не так сильно. Таким образом, избегайте калибровки на восходящих или падающих значениях. -> Если вы добавляете калибровку, вне плоского графика (например, при запуске нового сенсора), рекомендуется как можно скорее удалить эту калибровку и добавить новую при плоском графике ГК.
2.  На самом деле этот уровень автоматически учитывается при соблюдении правила 1, но надо удостовериться, что при контрольных замерах график гликемии также ровный в течение 15 минут и более. Не сравнивайте замеры на падениях и подъемах. Важно: замеры можно производить в любое время, но калибруйте только на ровных!
3.  Поскольку калибровка на ровных является хорошей основой, рекомендуется также калибровать сенсор только в пределах желаемого целевого диапазона, например от 70 до 160 мг/дл. Libre2 не работает в широком диапазоне, например от 50 мг/дл до 350 мг/дл (по крайней мере не линейно), поэтому калибруйте только в нужном диапазоне. -> Просто имейте в виду, что значения за пределами диапазона калибровки не будут точными.
4.  Не калибруйте слишком часто. Частые калибровки в основном приводят к ухудшению результатов. Когда сенсор дает хорошие результаты в на ровных сахарах, просто не добавляйте новых калибровок, так как это не будет иметь нужного эффекта. Достаточно перепроверять точность каждые 3-5 дней (конечно, на ровных).
5.  Избегайте калибровок, когда это не требуется. Это может показаться глупым, но не рекомендуется добавлять новую калибровку, если разница в уровне глюкозы в крови составляет всего ±10 мг/дл (например, уровень глюкозы в крови: 95, сенсор Libre 100 -> НЕ добавляйте калибровку 95, уровень глюкозы в крови: 95, сенсор Libre 115 -> добавьте калибровку 95)

Некоторые общие замечания: После активации нового сенсора и при окончании его срока службы, имеет смысл чаще проводить сравнительные измерения чем раз в 3-5 дней, как указано в правиле № 4. В новых и старых сенсорах чаще требуются перекалибровки. Время от времени сенсор не передает допустимых значений. Наиболее вероятно, что значение сенсора намного нижепо сравнению с фактическим уровнем глюкозы в крови ( например, сенсор: 50 mg/dl, ГК: 130 mg/dl) даже после калибровки. В этом случае добиться полезных результатов от сенсора не удастся. Например, при использовании модифицированного приложения можно максимально добавить смещение +20 мг/dl. Когда сенсор дает слишком низкие значения, не сомневаясь заменяйте его, так как ситуация не улучшится. Даже если сенсор неисправен, при слишком частых низких значениях, попробуйте другие участки тела. Даже на официально одобренных участках (верхняя часть руки) могут быть локации, где сенсоры не дают верных показаний. Методом проб и ошибок добивайтесь лучших результатов.
