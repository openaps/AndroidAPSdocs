SMS-команды
**************************************************
Безопасность прежде всего
==================================================
AndroidAPS позволяет контролировать телефон ребенка удаленно посредством текстовых сообщений (смс). Если смс-коммуникатор активирован, не забывайте, что телефон, настроенный на подачу удаленных команд, может быть украден. Поэтому всегда защищайте смартфон хотя бы ПИН-кодом. Рекомендуется использовать надежный пароль или биометрические данные.
* Кроме того, рекомендуется разрешить `второй номер телефона <#authorized-phone numbers>` _ для команд SMS. В том случае, если основной удаленный телефон будет потерян или украден, можно командой со второго телефона `временно отключить <#other> ` _ коммуникатор SMS.
* AndroidAPS при помощи смс также сообщит, выполнены ли удаленные команды, такие как болюс или изменения профиля. Рекомендуется сделать такую настройку, чтобы подтверждающие тексты направлялись по меньшей мере на два разных телефона на тот случай, если один из них украден.
* **Если вы подаете болюс через SMS-команды необходимо вводить углеводы через Nightscout (NSClient, сайт...)!** Если вы этого не сделаете, AAPS учтет правильное количество активного инсулина IOB, и будет считать, что активных углеводов COB слишком мало и, вероятно, не будет подавать корректировочный болюс, полагая, что у вас много активного инсулина.
* Начиная с версии AndroidAPS 2.7 при использовании SMS-команд необходимо использовать приложение-аутентификатор с одноразовым паролем.

Настройка SMS-команд
==================================================

.. изображение:: ../images/SMSCommandsSetup.png
  :alt: Настройка SMS команд
      
* Большинство корректировок временных целей, слежение за работой ААПС и т. д. может выполняться в приложении ` NSclient <../Children/Children.html> ` _ на Android-телефоне с подключением к Интернету.
* Болюсы не могут подаваться через Nightscout, но можно использовать SMS-команды.
* Если у вас для слежения iPhone и, следовательно, нет возможности использовать NSclient, доступны дополнительные SMS-команды.

* В настройках Android телефон перейдите в приложения > AndroidAPS > Разрешения и включите SMS

Авторизованные номера телефонов
--------------------------------------------------
* В AndroidAPS перейдите в Настройки > SMS коммуникатор и введите номер(а) телефона(ов), от которых разрешаете получать SMS команды (разделив их точками с запятыми), например + 6412345678; + 6412345679) 
* Включите «Разрешить удаленные команды при помощи SMS».
* Если вы хотите использовать более одного номера:

  * Введите только один номер.
  * Убедитесь, что этот телефон работает с алгоритмом путем отправки и подтверждения команды SMS.
  * Введите дополнительные номера, разделенные точкой с запятой, без пробела.
  
    .. изображение:: ../images/SMSCommandsSetupSpace2.png
      :alt: Команды SMS с нескольких номеров

Минуты между командами на болюс
--------------------------------------------------
* Можно определить минимальную задержку между двумя болюсами, поданными при помощи SMS.
* Из соображений безопасности следует добавить хотя бы два авторизованных номера телефона для изменения этого значения.

Дополнительно обязательный пин-код в конце маркера
--------------------------------------------------
* По соображениям безопасности за кодом ответа должен следовать PIN.
* Правила установки PIN:

  * от 3 до 6 цифр
  * не одинаковые цифры (напр. 1111)
  * не подряд (например, 1234)

Настройка аутентификации
--------------------------------------------------
* Для повышения безопасности используется двухфакторная аутентификация.
* Можно использовать любое приложение Authenticator, которое поддерживает маркеры TOTP RFC 6238. Популярные бесплатные приложения:

  * ` Authy <https://authy.com/download/>` _
  * Google Authenticator-` Android <https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2>` _/` iOS <https://apps.apple.com/de/app/google-authenticator/id388497605>` _
  * ` LastPass Authenticator <https://lastpass.com/auth/>` _
  * " FreeOTP Authenticator <https://freeotp.github.io/>` _

* Установите на телефоне-фолловере приложение идентификации по выбору и просканируйте QR-код, показанный в AAPS.
* Протестируйте одноразовый пароль, введя маркер, показанный в приложении идентификации, и ПИН, который вы только что настроили в AAPS. Пример:

  * Ваш обязательный PIN-код 2020
  * Маркер TOTP из приложения идентификации-457051
  * Введите 4570512020
   
* Красный текст "НЕПРАВИЛЬНЫЙ ПИН" изменится ** автоматически ** на зеленый "OK", если запись правильная. ** Никаких кнопок нажимать не надо**
* Время на обоих телефонах должно быть синхронизировано. Оптимальный вариант - установить на автоматическую настройку из сети. Различия во времени могут привести к проблемам аутентификации.
* Используйте кнопку "RESET AUTHENTICATORS", если хотите удалить предоставленные аутентификаторы.  (При сброс аутентификации вы делаете ВСЕ уже предоставленные аутентификаторы недействительными. Вам придется их снова настроить)

Отправка SMS-Команд
==================================================
* Отправьте SMS на телефон с AndroidAPS с подтвержденных номеров телефона(ов) используя любую из `команд <../Children/SMS-Commands.html#commands>`_ ниже. 
* Телефон с AAPS ответит чтобы подтвердить успешное выполнение команды или запрашиваемого статуса. 
* Подтвердите команду, при необходимости отправив код. Пример:

  * Ваш обязательный PIN-код 2020
  * Маркер TOTP из приложения идентификации-457051
  * Введите 4570512020

**Подсказка: Если отправляется много SMS, полезно держать функцию SMS незанятой на обоих телефонах,.

Команды
==================================================
Команды должны отправляться на английском языке, ответ будет получен на русском языке, если строка ответа уже " переведена <../translations.html#translate-strings-pl-androidaps-app> ` _.

.. изображение:: ../images/SMSCommandsSetup.png
  :alt: Пример команд SMS

Замкнутый цикл
--------------------------------------------------
* LOOP STOP/DISABLE (* ОТКЛЮЧИТЬ ЗЦ)
  * Ответ: цикл отключен
* LOOP START/ENABLE (* ВКЛЮЧИТЬ ЗЦ)
  * Ответ: цикл включен
* LOOP STATUS (* СТАТУС ЗЦ)

  * Ответ зависит от фактического состояния

    * цикл не работает
    * цикл работает
    * Остановлен (на 10 мин)
* LOOP SUSPEND 20 (* ОСТАНОВИТЬ ЗЦ на 20)
  * Зцикл остановлен на 20 минут
* LOOP RESUME (* ВОЗОБНОВИТЬ ЗЦ)
  * Ответ: Цикл возобновлен

Данные мониторинга
--------------------------------------------------
* BG (ГК)
  * Ответ: новая ГК: 5.6 4мин назад, дельта: -0,2 ммоль, активный инсулин IOB: 0.20 ед (болюс: 0.10 ед базал: 0.10 ед)
* CAL 5.6 (калибровка 5.6)
  * Ответ: Для отправки калибровки 5.6 ответьте кодом из приложения Authenticator и подтвердите своим PIN-кодом
  * Ответ после получения правильного кода: Калибровка отправлена / Calibration sent (* *Если установлен xDrip. Разрешение на прием калибровок должно быть включено в xDrip+**)

базал
--------------------------------------------------
* BASAL STOP/CANCEL (остановить/отменить) базал
  * Ответ: Для остановки временного базала ответьте кодом из приложения Authenticator и подтвердите своим PIN-кодом
* BASAL 0.3 (база 0,3)
  * Ответ: Для постановки базала на 0.3 ед/ч ответьте кодом из приложения Authenticator и подтвердите своим PIN-кодом
* BASAL 0.3 20 (базал 0,3 20)
  * Ответ: Для постановки базала на 0.3 ед/ч на 20 мин ответьте кодом из приложения Authenticator и подтвердите своим PIN-кодом
* BASAL 30% (базал 30%)
  * Ответ: Для постановки базала на 30% ед/ч на 30 мин. ответьте кодом из приложения Authenticator и подтвердите своим PIN-кодом
* БАЗАЛ 30% 50
  * Ответ: Для постановки базала на 30% ед/ч на 50 мин. ответьте кодом из приложения Authenticator и подтвердите своим PIN-кодом

болюс
--------------------------------------------------
Удаленный болюс разрешается только через 15 минут после предыдущей команды болюс или других удаленных команд (значение редактируется если для передачи команд добавлено 2 номера телефона)! * Поэтому ответ зависит от времени последнего болюса.

* Болюс 1.2
  * Response A: Чтобы подать болюс 1.2 ед. ответьте кодом из приложения Authenticator и подтвердите своим PIN-кодом
  * Ответ B: Удаленный болюс недоступен. Повторите позже.
* БОЛЮС на 0.60 ЕДЫ
  * Если вы зададите необязательный параметр прием пищи MEAL, то будет задано значение временная цель прием пищи MEAL (значения по умолчанию: 90 мг/дл, 5,0 ммоль/л на 45 мин).
  * Response A: To deliver meal bolus 0.60U reply with code from Authenticator app for User followed by PIN
  * Ответ B: Удаленный болюс недоступен. 
* УГЛИ 5
  * Response: To enter 5g at 12:45 reply with code from Authenticator app for User followed by PIN
* УГЛИ 5 17:35/5:35PM
  * Response: To enter 5g at 17:35 reply with code from Authenticator app for User followed by PIN
* EXTENDED STOP/CANCEL
  * Response: To stop extended bolus reply with code from Authenticator app for User followed by PIN
* EXTENDED 2 120
  * Response: To start extended bolus 2U for 120 min reply with code from Authenticator app for User followed by PIN

Профиль
--------------------------------------------------
* СТАТУС ПРОФИЛЯ
  * Ответ: Профиль1
* СПИСОК ПРОФИЛЕЙ
  * Ответ: 1. ` Profile1 ` 2. ` Profile2 `
* PROFILE 1
  * Response: To switch profile to Profile1 100% reply with code from Authenticator app for User followed by PIN
* PROFILE 2 30
  * Response: To switch profile to Profile2 30% reply with code from Authenticator app for User followed by PIN

Другое
--------------------------------------------------
* ОБНОВИТЬ НАЗНАЧЕНИЯ
  * Ответ: Синхронизировать назначения с NS
* ПЕРЕЗАПУСТИТЬ NSCLIENT
  * Ответ: Перезапуск NSCLIENT 1 получатель
* ПОМПА
  * Response: Last conn: 1 min ago Temp: 0.00U/h @11:38 5/30min IOB: 0.5U Reserv: 34U Batt: 100
* PUMP CONNECT
  * Response: Pump reconnected
* PUMP DISCONNECT *30*
  * Response: To disconnect pump for *30* minutes reply with code from Authenticator app for User followed by PIN
* ОТКЛЮЧИТЬ/ОСТАНОВИТЬ СМС
  * Ответ: Чтобы отключить удаленную службу SMS ответьте кодом Any. Имей в виду, что вы сможете его повторно активировать только непосредственно с главного смартфона AAPS.
* ЦЕЛЬ ПРИЕМ ПИЩИ/НАГРУЗКА/ГИПО MEAL/ACTIVITY/HYPO   
  * Response: To set the Temp Target MEAL/ACTIVITY/HYPO reply with code from Authenticator app for User followed by PIN
* ЦЕЛЬ ОСТАНОВИТЬ/ОТМЕНИТЬ   
  * Response: To cancel Temp Target reply with code from Authenticator app for User followed by PIN
* СПРАВКА
  * Ответ: ГК, ПЕТЛЯ, НАЗНАЧЕНИЯ, .....
* СПРАВКА БОЛЮС
  * Ответ: БОЛЮС 1.2 БОЛЮС 1.2 НА ЕДУ

Устранение неполадок
==================================================
Множество SMS
--------------------------------------------------
Если вы получаете одно и то же сообщение снова и снова (напр. переключение профиля), вероятно, у вас произошло закольцовывание с другими приложениями. Это может быть xDrip+, например. If so, please make sure that xDrip+ (or any other app) does not upload treatments to NS. 

If the other app is installed on multiple phones make sure to deactivate upload on all of them.

Команды SMS не работают на телефонах Samsung
--------------------------------------------------
Была жалоба на остановку работы SMS команд после обновления на телефоне Galaxy S10. Could be solved by disabling 'send as chat message'.

.. изображение:: ../images/SMSdisableChat.png
  :alt: Отключить SMS как сообщение чата
