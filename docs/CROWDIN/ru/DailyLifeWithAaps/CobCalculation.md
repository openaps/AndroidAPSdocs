# Подсчет активных углеводов COB

## Как AAPS вычисляет значение COB?

Когда пользователь вводит углеводы во время приема пищи или при коррекции, **AAPS** добавляет это значение к текущему количеству активных углеводов (**COB**). После этого **AAPS** рассчитывает усвоение углеводов на основе наблюдаемых отклонений от значений **ГК пользователя**. Скорость усвоения зависит от коэффициента чувствительности к углеводам (**CSF**). Эта функция не указана в **Профиле**, она рассчитывается алгоритмом **AAPS** в соответствии с настройками **ISF/I:C** и зависит от того, насколько 1 грамм углеводов потребляемой пищи увеличит гликемию **ГК** пользователя.

## Фактор чувствительности к углеводам

Подсчет в **AAPS** ведется по следующей формуле:

- усвоенные углеводы = отклонение * углеводный коэффициент ic / фактор чувствительности к инсулину isf.

При этом на ** Профиль ** пользователя происходит следующее воздействие:

- _повышение _ **IC ** -увеличение усваивамых каждые 5 минут углеводов тем самым уменьшает общее время усвоения;

- _повышение _ **ISF**- уменьшение усваиваемых каждые 5 минут углеводов тем самым продлевает общее время усвоения

- _изменение_ ** процента Профиля** - увеличение/уменьшение обеих величин таким образом не влияет на время усвоения углеводов.

Например, если в **Профиле** пользователя **ISF** равен 100, а углеводный коэффициент **I:C** равен 5, Rоэффициент чувствительности пользователя к углеводам будет равен 20. При каждом увеличении **гликемии** пользоателя на 20 мг/дл (1,1 ммоль/л) **AAPS** считает, что организм поглотил 1 г углеводов. Положительное значение активного инсулина **IOB** также влияет на расчет **COB**. Таким образом, если **AAPS** предсказывает, что **ГК пользователя** снизится на 20 мг/дл  (1,1 ммоль/л) из-за действия активного инсулина **IOB**, а гликемия вместо этого остается неизменной, то  алгоритм **AAPS** будет считать, что усвоен 1 г углеводов.

Усвоение углеводов также будет рассчитываться с помощью методов, описанных ниже, в зависимости от выбора алгоритма чувствительности в настройках **AAPS**.

## Чувствительность к углеводам - Oref1

Непоглощенные углеводы отбрасываются после указанного времени:

![Oref1](../images/cob_oref0_orange_II.png)

![Screenshot 2024-10-05 161009](../images/cob_oref0_orange_I.png)


## Чувствительность к углеводам - средневзвешенная

Усвоение принимается из рассчета, что активные углеводы COB = 0 по истечении указанного времени:

![AAPS, WheitedAverage](../images/cob_aaps2_orange_II.png)

Если вместо значения, рассчитанного на основе отклонений **ГК**, используется минимальное поглощение углеводов (min_5m_carbimpact), на графике **COB** появится оранжевая точка.

(CobCalculation-detection-of-wrong-cob-values)=
## Обнаружение неправильного значения COB

**AAPS** предупредит пользователя о неверном подсчете углеводов **COB** перед подачей болюса, если  от предыдущего приема пищи остаются активные углеводы **COB**,. В этом случае пользователь получит дополнительную подсказку на экране подтверждения калькулятора болюса.

### Как AndroidAPS обнаруживает неправильные значения активных углеводов COB?

В обычных расчетах __AAPS__ определяет усвоение углеводов по отклонениям **ГК**. В случае, если пользователь ввел углеводы, а **AAPS** не может рассчитать их предполагаемое усвоение по отклонениям **ГК**, то алгоритмом применяется метод [min_5m_carbimpact](#Preferences-min_5m_carbimpact) (так называемый "запасной вариант"). Поскольку этот метод вычисляет только минимальное усвоение углеводов, без учета отклонений **ГК**, то в этом случае возможны некорректные значения активных углеводов COB.

![Hint on wrong COB value](../images/Calculator_SlowCarbAbsorption.png)

На снимке экрана выше 58% времени поглощения углеводов был вычислен математически методом min_5m_carbimpact вместо значения, основанного на отклонениях ГК. Это означает, что на самом деле у пользователя может быть меньше активных углеводов **COB**, чем рассчитывает алгоритм.

### Как относиться к этому предупреждению?

- Подумайте об отмене терапевтического действия - нажмите «Отмена» вместо ОК.
- -Заново рассчитайте свой предстоящий прием пищи с помощью калькулятора болюса, сняв галочку с активных углеводов **COB**.
- Если требуется болюс на коррекцию, введите его вручную.
- Будьте осторожны, не допустиеь передозировки или переизбытка инсулина!


### Почему алгоритм неправильно распознает активные углеводы COB?

Это может быть вызвано тем, что:
- Пользователь мог переоценить количество углеводов при вводе записи.
- После предыдущего приема пищи происходила физическая активность или нагрузка.
- -Углеводный коэффициент I:C нуждается в корректировке.
- Значение для min_5m_carbimpact неверно (рекомендуется 8 для алгоритма SMB, 3 для OpenAPS AMA).


## Ручная коррекция введенных углеводов

Если углеводов слишком много или наоборот недостаточно, это можно исправить с помощью вкладки "Терапия" и вкладки "Действия" / меню, как описано [ здесь](#screens-bolus-carbs).


## Коррекция количества углеводов - как удалить запись из Терапии


Для исправления ошибочной записи об углеводах, можно воспользоваться вкладкой "Терапия", удалив ее оттуда. This may be because the user over or underestimated the carb entry:

![COB_Screenshot 2024-10-05 170124](../images/e123d85d-907e-4545-bf1b-09fee4d42555.png)

1. Check and remember actual **COB** and **IOB** on the **AAPS'** homescreen.
2. Depending on the pump, the carbs in the Treatments tab might show together with insulin in one line or as a separate entry (i.e. with Dana RS).
3. Remove the entry by firstly 'ticking' the waste bin on the top right corner (see above photo, step 1). Then 'tick' the faulty carb amount (see above photo, step 2). Then 'tick' the ‘waste bin’ on the top right corner (step 1 again).
4. Make sure carbs are removed successfully by checking **COB** on **AAPS’** homescreen again.
5. Do the same for **IOB** if there is just one line in the Treatment tab including carbs and insulin.
6. If carbs are not removed as intended and additional carbs are added as explained in this section, the **COB** entry will be too high and this could lead to **AAPS** delivering too much insulin.
7. Enter correct carbs amount through carbs button on **AAPS’** homescreen and set the correct event time.
8. If there is just one line in Treatment tab including carbs and insulin the user should add also the amount of insulin. Make sure to set the correct event time and check **IOB** on homescreen after confirming the new entry.

