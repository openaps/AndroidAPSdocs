# Profile switch/смена профиля

При запуске AndroidAPS и выборе проиля необходимо выполнить "Profile switch" с нулевой продолжительностью действия (объясняется ниже). При этом AAPS начинает отслеживать историю профилей, а каждое новое изменение профиля требует другого "переключения профиля" даже при изменении содержимого профиля в NS. Обновленный профиль немедленно передается в AAPS, но для начала использования этих изменений необходимо снова включить один и тот же профиль (в NS или AAPS).

Внутри себя AAPS создает моментальную копию профиля с начальной датой и длительностью и использует ее в выбранный период. Нулевая длительность означает постоянную работу. Такой профиль действителен до нового "переключения профиля".

Чтобы выполнить переключение профиля, нажмите и удерживайте имя вашего профиля ("Tuned 03/11" на рисунке ниже).

![Переключить профиль](../images/ProfileSwitch_HowTo.png)

Если вы используете "Переключатель профиля" с указанием длительности, то профиль вернется на предыдущий допустимый

Если вы используете локальные профили AAPS (Simple, Local, CPP), вы должны нажать эту кнопку, чтобы применить изменения (это создает правильное событие "Profile switch").

В рамках "переключения профиля" можно выбрать два дополнительных изменения, которые раньше были частью суточного процентного профиля Circadian Percentage Profile:

## Процент

* Это применяет одинаковый процент ко всем параметрам. 
* Если установить его на 130% (то есть вы на 30% более инсулинорезистентны), то он повысит базальную скорость на 30%. Кроме того, соответственно снизится чувствительность к инсулину ISF и соотношение инсулин-углеводы (делятся на 1.3 в данном примере).
  
  ![Пример переключения профиля в процентах](../images/ProfileSwitchPercentage.png)

* Эти установки будут отправлены в помпу, а затем будут использоваться по умолчанию.

* Алгоритм цикла (открытый или закрытый) продолжит работу на основе выбранного процентного профиля. Так, отдельные процентные профили могут быть установлены для различных этапов гормонального цикла.

## Сдвиг по времени

![Переключение профиля в процентах и сдвиг по времени](../images/ProfileSwitchTimeShift2.png)

* Эта установка позволяет сместить профиль на введенное число часов. 
* Так, например, когда работаете в ночные смены, сдвиньте часы на то, насколько позже/раньше вы ложитесь спать или просыпаетесь.
* Всегда возникает вопрос о том, какие настройки должны сменять параметры текущего времени. Это время должно быть сдвинуто на х часов. Следуйте инструкции, описанной в этом примере: 
  * Текущее время: 12:00
  * **Сдвиг в сторону увеличения** времени 
    * 2:00 ** + 10 ч **-> 12:00
    * Параметры от 2:00 будут использоваться вместо параметров, обычно используемых в 12:00 из-за положительного сдвига времени.
  * **Сдвиг в сторону уменьшения ** времени 
    * 22:00 ** -10 ч **-> 12:00
    * Параметры от 22:00 будут использоваться вместо параметров, обычно используемых в 12:00 из-за отрицательного сдвига времени.

![Инструкции по смене профиля и часового пояса](../images/ProfileSwitch_PlusMinus2.png)

Этот механизм захвата снимков профиля позволяет гораздо точнее вычислить прошлое и дает возможность отслеживать изменения профиля.

## Устранение ошибок профиля

### 'Недопустимый профиль'/'Профиль базала не скорректирован по часам '

![Базал не соответствует распределению по часам](../images/BasalNotAlignedToHours2.png)

* Эти сообщения об ошибках будут появляться, если базальные скорости или коэффициенты I:C не выверены по часам. (Так, помпы DanaR и DanaRS не поддерживают изменения в течение получаса)
  
  ![Пример профиля не распределен по часам](../images/ProfileNotAlignedToHours.png)

* Запомните / запишите дату и время, указанные в сообщении об ошибке (26/07/2019 5:45 pm на снимке экрана выше).

* Перейдите на вкладку терапии
* Выберите Переключатель профилей
* Прокрутите страницу пока не найдете дату и время сообщения об ошибке.
* Используйте функцию удаления.
* Иногда находится не только один неисправный коммутатор профиля. В этом случае удалите также другие.
  
  ![Удалите переключатель профиля](../images/PSRemove.png)

Как вариант, можно удалить переключатель профиля непосредственно в mLab, как описано ниже.

### 'Получено переключение профиля из NS, но профиль не существует локально'

* Запрошенный профиль не синхронизирован корректно с Nightscout.
* Следуйте инструкциям выше, чтобы удалить переключатель профиля

Как вариант, можно удалить переключатель профиля непосредственно в mLab:

* Перейдите в коллекцию mlab
* Найдите в терапии переключатель профиля
* Удалите переключатель профиля с датой и временем, указанным в сообщении об ошибке. ![mlab](../images/mLabDeletePS.png)

### Слишком короткое время действия инсулина "DIA 3hr"

* Сообщение об ошибке появится, если длительность действия инсулина в вашем профиле указана со значением, которое AndroidAPS не признает точным. 
* Прочитайте о [ выборе правильного времени действия инсулина DIA ](https://www.diabettech.com/insulin/why-we-are-regularly-wrong-in-the-duration-of-insulin-action-dia-times-we-use-and-why-it-matters/) и отредактируйте его в своем профиле, затем выполните [ Profile Switch ](../Usage/Profiles), чтобы продолжить.